% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
  letterpaper,
  DIV=11,
  numbers=noendperiod]{scrreprt}

\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\setcounter{secnumdepth}{5}
% Make \paragraph and \subparagraph free-standing
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi


\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{3em}
\newlength{\cslentryspacingunit} % times entry-spacing
\setlength{\cslentryspacingunit}{\parskip}
\newenvironment{CSLReferences}[2] % #1 hanging-ident, #2 entry spacing
 {% don't indent paragraphs
  \setlength{\parindent}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1
  \let\oldpar\par
  \def\par{\hangindent=\cslhangindent\oldpar}
  \fi
  % set entry spacing
  \setlength{\parskip}{#2\cslentryspacingunit}
 }%
 {}
\usepackage{calc}
\newcommand{\CSLBlock}[1]{#1\hfill\break}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{#1}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{#1}\break}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}

\KOMAoption{captions}{tableheading}
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{bookmark}{}{\usepackage{bookmark}}
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Table of contents}
\else
  \newcommand\contentsname{Table of contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{List of Figures}
\else
  \newcommand\listfigurename{List of Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{List of Tables}
\else
  \newcommand\listtablename{List of Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figure}
\else
  \newcommand\figurename{Figure}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother
\makeatletter
\@ifpackageloaded{tcolorbox}{}{\usepackage[many]{tcolorbox}}
\makeatother
\makeatletter
\@ifundefined{shadecolor}{\definecolor{shadecolor}{rgb}{.97, .97, .97}}
\makeatother
\makeatletter
\makeatother
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Macro-dynamics of Sorting between Workers and Firms (and Locations)},
  pdfauthor={Mitchell Valdes-Bobes},
  colorlinks=true,
  linkcolor={blue},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}

\title{Macro-dynamics of Sorting between Workers and Firms (and
Locations)}
\author{Mitchell Valdes-Bobes}
\date{August 24, 2023}

\begin{document}
\maketitle
\begin{abstract}
Lorem ipsum dolor sit amet.
\end{abstract}
\ifdefined\Shaded\renewenvironment{Shaded}{\begin{tcolorbox}[borderline west={3pt}{0pt}{shadecolor}, interior hidden, enhanced, breakable, frame hidden, sharp corners, boxrule=0pt]}{\end{tcolorbox}}\fi

\renewcommand*\contentsname{Table of contents}
{
\hypersetup{linkcolor=}
\setcounter{tocdepth}{2}
\tableofcontents
}
\bookmarksetup{startatroot}

\hypertarget{introduction}{%
\chapter{Introduction}\label{introduction}}

\emph{Notes}:

\begin{itemize}
\tightlist
\item
  I adopt the framework from
  (\protect\hyperlink{ref-liseMacrodynamicsSortingWorkers2017}{Lise and
  Robin 2017}).
\item
  Introducing a fixed amount of locations and population distribution of
  workers should be an equilibrium outcome.
\item
  Workers can ``partially'' direct their search to each location.

  \begin{itemize}
  \tightlist
  \item
    In practice workers randomize over locations paying a cost.
  \item
    Cost of random search is zero.
  \item
    Cost increases unboundedly as the worker directs their search to a
    particular location.
  \end{itemize}
\item
  Productivity depends on the quality of match and aggregate state as in
  the original paper. I want to introduce a third component which is
  location productivity.

  \begin{itemize}
  \tightlist
  \item
    I intend to use idea exchange as the driver of location
    productivity.
  \item
    I plan to draw on a framework similar to
    (\protect\hyperlink{ref-davisSpatialKnowledgeEconomy2019a}{\textbf{davisSpatialKnowledgeEconomy2019a?}})
    to model the value added to production by idea exchange.
  \end{itemize}
\end{itemize}

\textbf{TODO}:

\begin{itemize}
\tightlist
\item[$\boxtimes$]
  Dynamic programing problem changed to keep track of value of moving
  across locations.
\item[$\boxtimes$]
  \textbf{Important and easy} Change notation so that total number of
  locations \(J\) is not the same letter as value of match \(J^j(x,y)\)
\item[$\square$]
  Read
  (\protect\hyperlink{ref-simsImplicationsRationalInattention2003}{Sims
  2003})
\item[$\boxtimes$]
  Add references to literature using similar cost structure for mixed
  strategies.
\item[$\square$]
  Compute the distribution of skill in each location.
\item[$\square$]
  Check the ratios of vacancies of each type of firm in each location
  when computing the law of motion of the unemployment rate.
  {\textbf{Important: I think I have it wrong now.}}
\item[$\square$]
  Check that the unemployment value function is a contraction.
\item[$\square$]
  Make location productivity a result of the distribution of skill in
  each location.
\item[$\square$]
  Add cost of living to the model.
\item[$\boxtimes$]
  \textbf{Less Important} Fix Appendix.
\item[$\square$]
  Think about distribution of firms across and within locations.
\item[$\square$]
  Solve a modified version of the model where there is no aggregate
  state.
\item[$\square$]
  Solve a two location version of the model to gain intuition.
\item[$\square$]
  Think if I could include the cost of moving to a different location in
  the cost of the mixed strategy.
\end{itemize}

\bookmarksetup{startatroot}

\hypertarget{model}{%
\chapter{Model}\label{model}}

\hypertarget{model-setup}{%
\section{Model Setup}\label{model-setup}}

\hypertarget{demographics}{%
\subsection{Demographics}\label{demographics}}

\begin{itemize}
\tightlist
\item
  There is a discrete and finite set of locations
  \(\mathcal{J}=\{1,\dots,|\mathcal{J}|\}\) locations indexed by
  \(j\in\mathcal{J}\).
\item
  Continuum of workers indexed by their ability \(x\in \mathcal{X}\).

  \begin{itemize}
  \tightlist
  \item
    The total measure is normalized to \(1\).
  \item
    Exogenous distribution \(\ell(x)\)
  \item
    Endogenous distribution in each location \(\ell^{j}(x)\)
  \item
    Denote \(\mu_j\) the total population in location \(j\).
  \end{itemize}
\item
  Continuum of firms indexed by technology \(y\in \mathcal{Y}\).

  \begin{itemize}
  \tightlist
  \item
    Total measure is normalized to \(1\).
  \item
    Uniformly distributed.
  \end{itemize}
\item
  The exogenous cost of posting \(v\) job opportunities in location
  \(j\) is \[c_{j}(v)\geq0\] assume it is increasing, convex, and
  independent of the firm type \(y\) (but \emph{potentially} dependent
  on location).
\item
  The aggregate state of the economy is indexed by \(z_t\) .

  \begin{itemize}
  \tightlist
  \item
    Changes from \(z\) to \(z'\) according to the Markov transition
    probability \(\pi(z, z')\).
  \end{itemize}
\item
  Workers and firms discount the future at the rate \(\beta\).
\item
  Workers can move across locations:

  \begin{itemize}
  \tightlist
  \item
    Workers choose a mixed strategy to search: \[
    \phi^i_j(x) = \{\phi^i_j(x, j')\}_{j'\in \mathcal{J}}
    \] where \(\phi^i_j(x, j')\) is the probability that a type \(x\)
    worker from location \(j\) search in location \(j'\) and
    \(i\in \{u,e\}\) refers to the employment status of the worker.
  \item
    Each strategy has an asociated cost \(c_s(\phi^i_j(x))\):
    \footnote{The cost is proportional to the Kullback--Leibler
      divergence between the selected distribution and a uniform. Note
      that if the worker selects random search (i.e.~uniform
      distribution) the asociated cost is \(0\) and the cost grows
      unboundedly large as the strategy gets closer to perfect directed
      search to a particular location. More information on the
      Kullback--Leibler divergence
      \href{https://en.wikipedia.org/wiki/Kullback\%E2\%80\%93Leibler_divergence}{here}}
    works that use this cost structure are
    (\protect\hyperlink{ref-wuPartiallyDirectedSearch2020}{Wu 2020}) and
    (\protect\hyperlink{ref-cheremukhinTargetedSearchMatching2020}{Cheremukhin,
    Restrepo-Echavarria, and Tutino 2020}).

    \begin{itemize}
    \tightlist
    \item
      (\protect\hyperlink{ref-wuPartiallyDirectedSearch2020}{Wu 2020})
      mentions that this cost structure can be derived from rational
      inantention as in
      (\protect\hyperlink{ref-simsImplicationsRationalInattention2003}{Sims
      2003}) I should read that paper. \[
      c_s(\phi^i_j(x)) = c_1 \left(\sum_{j'\in \mathcal{J}}\phi^i_j(x, j')\log{(J\phi^i_j(x, j'))}\right)
      \]
    \end{itemize}
  \item
    When a worker move they must pay a cost \(F^{j \to j'}\geq 0\) with
    \(F^{j\to j} = 0\).
  \end{itemize}
\end{itemize}

\hypertarget{technology}{%
\subsection{Technology}\label{technology}}

\begin{itemize}
\tightlist
\item
  Unemployed workers instant utility in each location is
  \(b(x,z,j)\).\footnote{In
    (\protect\hyperlink{ref-liseMacrodynamicsSortingWorkers2017}{Lise
    and Robin 2017}) \(b(x)\) stands for unemploymet benefits, I want to
    be more general to be able to include differerences in cost of
    living across locations}
\item
  Firms have access to a production technology, defined at the match
  level and depending on the location and the aggregate state of the
  economy \(f(x, y, j, z)\).
\end{itemize}

\hypertarget{job-search}{%
\subsection{Job Search}\label{job-search}}

The timing is as follows: At time \((t)\):

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Distributions of employed and unemployed workers are inherited from
  \(t-1\).

  \begin{itemize}
  \tightlist
  \item
    \(u^j_t(x)\) is the measure of type-\(x\) Unemployed workers at the
    location \(j\).
  \item
    \(h^j_t(x,y)\) is the measure of type-\(x\) workers employed at the
    firm \(y\) at the location \(j\).
  \item
    Note that on each location:
    \[u^j_t(x) + \int h^j_t(x,y) dy = \ell^j(x)\]
  \end{itemize}
\item
  Aggregate state changes \(z_{t-1} \to z_{t}\).
\item
  At time \((t+)\) Separations occur:

  \begin{itemize}
  \tightlist
  \item
    \(u^j_{t+}(x)\) is the measure of the type \(x\) Unemployed workers
    in the location \(j\) after the shock.
  \item
    \(h^j_{t+}(x,y)\) is the measure of type \(x\) workers that remain
    employed at firm \(y\) in location \(j\).
  \end{itemize}
\item
  Unemployed and employed workers draw new offers.
\end{enumerate}

Both unemployed and employed workers search, denote \(s\) the search
intensity of an employed worker and \(1\) is the (normalized) search
intensity of an unemployed worker. The total search intensity in
location \(j\) is

\[
  L^j_t = \sum_{j'\in\mathcal{J}}\left[\int u^{j'}_{t+}(x) dx + s\int\int h^{j'}_{t+}(x,y)dx dy\right]
\]

Let \(v^j_t(y)\) be the number of job opportunities posted by a firm
\(y\) at time \(t\) in the location \(j\).

\begin{itemize}
\tightlist
\item
  \(V^j_t = \int v^j_t(y) dy\) is the total number of job opportunities
  posted at the time \(t\) in the location \(j\).
\end{itemize}

Let \(M^j_t = M(L^j_t, V^j_t)\) The number of job matches in the
location \(j\) then:

\begin{itemize}
\tightlist
\item
  The probability that an unemployed worker contacts a vacancy in the
  location \(j\) is \[p^j_t = \frac{M^j_t}{L^j_t}\]

  \begin{itemize}
  \tightlist
  \item
    \(sp^j_t\) is the probability that an employed worker contacts a
    vacancy.
  \end{itemize}
\item
  The probability that a ﬁrm contacts any searching worker
  \[q^j_t = \frac{M^j_t}{V^j_t}\]
\end{itemize}

\hypertarget{dynamic-programming-problem}{%
\section{Dynamic Programming
Problem}\label{dynamic-programming-problem}}

Denote:

\begin{itemize}
\tightlist
\item
  \(U^{j}_t(x)\) the value for an unemployed worker of type \(x\) at
  time \(t\) at location \(j\).
\item
  The value of getting an offer depends on whether the worker is
  employed or not:

  \begin{itemize}
  \tightlist
  \item
    \(W^{j'\to j}_{0, t}(x,y)\) is the value of a type-\(x\) unemployed
    worker at location \(j'\) who is hired by a ﬁrm of type \(y\) at a
    location \(j\).
  \item
    \(W^{j'\to j}_{1, t}(x,y,y')\) is the value offered at the time
    \(t\) by type \(y\) firm at location \(j\) to a type \(x\) worker
    employment at a type \(y'\) firm in location \(j'\).
  \end{itemize}
\item
  \(J^j_t(x,y)\) is the value of a match between a type \(x\) worker and
  a type \(y\) firm at time \(t\) in location \(j\).
\end{itemize}

\hypertarget{unemployed-worker}{%
\subsection{Unemployed Worker}\label{unemployed-worker}}

Unemployed workers receive instant utility from living in location
\(j\), \(b(x,j, z)\), and anticipate next period's aggregate state
\(z_{t+1}\), and the probability of getting an offer \(p^j_{t+1}\) in
each location. They will choose the strategy that maximizes their future
expected value knowing that in each location they will receive an offer
which can be from any firm with a likelihood proportional to the share
of total vacancies posted by each firm in each market. The worker will
accept only the offers that promise her a higher value than
unemployment:

\begin{align*}
U^{j}_{t}(x) = b(x,j, z) + &\beta\max_{\phi^j_u(x)}\left\{ -c(\phi^j_u(x)) + \phi^j_u(x, j')\mathbb{E}_{t}
      \sum_{j'\in \mathcal{J}} \left[ 
      (1-p^{j'}_{t+1})U^{j'}_{t+1}(x) +\ldots\right. \right. \\
& \left. \left. \hspace{3cm} \ldots + p^{j'}_{t+1} \int \max\left\{U^{j'}_{t+1}(x),W^{j\to j'}_{0, t+1}(x,y)- F^{j \to 
j'}\right\}\frac{v^{j}_{t+1}(y)}{V^{j}_{t+1}}dy \right] \right\} 
\end{align*}

Assume that workers don't have bargaining power, therefore they are
offered their reservation value
\(U^{j'}_t(x)=W^{j\to j'}_{0, t+1}(x,y)- F^{j \to j'}\) by firms:
\[U^{j}_{t}(x) = b(x, j, z) + \beta \max_{\phi^j_u(x)} \left\{\sum_{j'\in \mathcal{J}} \left(\phi^j_u(x, j')\mathbb{E}_t\left[U^{j'}_{t+1}(x)  \right]\right) -c(\phi^j_u(x)) \right\} \]

This means that the optimal search policy for each worker is
\begin{equation}\protect\hypertarget{eq-optimal-search-unemployed}{}{ \phi^j_u(x,j') = \frac{e^{\left(\mathbb{E}_t\left[U^{j'}_{t+1}(x)\right] /c_1\right)}}{\sum_{\tilde{j}\in \mathcal{J}}e^{\left(\mathbb{E}_t\left[U^{\tilde{j}}_{t+1}(x)\right] /c_1\right)}}}\label{eq-optimal-search-unemployed}\end{equation}

derivation is in Chapter~\ref{sec-appendix_search_unemp}.

Substituting the optimal strategy into the Bellman Equation of the
unemployed worker we get (derivation in
Chapter~\ref{sec-appendix_bellman_unemp}):
\[U^{j}_{t}(x) = b(x, j, z) + \beta c_1 \log{\left( \sum_{j' \in \mathcal{J}}\exp{\left(\mathbb{E}_t[U_{t+1}^{j'}(x)]/c_1\right)}-\log{(J)}\right)}\]
or simply
\begin{equation}\protect\hypertarget{eq-bellman-unemployed}{}{U^{j}_{t}(x)=b(x,j,z)+\beta c_{1}\text{lse}\left(\left\{\frac{\mathbb{E}_{t}[U^{j'}_{t+1}(x)]}{c_{1}}\right\}\right) - \beta c_{1}\log{J}}\label{eq-bellman-unemployed}\end{equation}

Where \(\text{lse}(x\in \mathbb{R}^n)\) is the \textbf{log-sum-exp}
function.

\hypertarget{firm}{%
\subsection{Firm}\label{firm}}

\begin{itemize}
\tightlist
\item
  If a match between a worker and a firm in location \(j\) is destroyed
  the firm will get \(0\) and the worker gets their unemployment value
  in that location \(U^j_t(x)\).
\item
  Matches are destroyed for two reasons:

  \begin{itemize}
  \tightlist
  \item
    \emph{Exogenous destruction} with probability \(\delta\)
  \item
    \emph{Endogenous destruction}, if and only if
    \(J^j_t(x,y) < U^j_t(x)\).

    \begin{itemize}
    \tightlist
    \item
      Denote
      \(\lambda^j_{t}(x,y) = \mathbb{1}_{\{J^j_{t}(x,y)>U^j_{t}(x,y)\}}\)
    \end{itemize}
  \end{itemize}
\end{itemize}

We can write the Bellman equation of a match value as:

\begin{align*}
J^j_t(x,y) = \underbrace{f(x,y,j,z_t)}_{\text{match value added}} &+ \beta\max_{\phi^j_s(x)}\left\{\mathbb{E}_t\left[  \overbrace{ (1-(1-\delta)\lambda^j_{t+1}(x,y)) }^{\text{match is destroyed}}\underbrace{U^j_{t+1}(x)}_{\text{worker gets unemployment value}} \right. \right. + \ldots\\
\ldots + & \underbrace{(1-\delta)\lambda^j_t(x,y)}_{\text{match survives}} \max_{\phi_s^j(x)}\left\{-c(\phi_s^j(x)) +  \sum_{j'\in\mathcal{J}}\phi^j_s(x,j')\left[ \overbrace{(1-sp^{j'}_t)}^{\text{no new offers}} \underbrace{J^j_{t+1}(x,y)}_{\text{stays with same firm}} \right. \right. +\ldots\\
&\ldots +sp^{j'}_t \left.\left. \underbrace{\int\max\{J^{j}_{t+1}(x,y),W^{j\to j'}_{1,t+1}(x,y',y)-F^{j\to j'}\}\frac{v^{j'}_{t+1}(x)}{V^{j'}_{t+1}}dy'}_{\text{worker only accepts new offers if value is greater than current match}}  \right] \right\}
\end{align*}

When a type \(x\) worker employed at a type \(y\) firm in city \(j\)
receives an offer from a type \(y'\) in city \(j'\) then there is a
sequential auction like in
(\protect\hyperlink{ref-postel-vinayEquilibriumWageDispersion2002}{Postel-Vinay
and Robin 2002}). More productive firms can offer higher values. The key
difference with
(\protect\hyperlink{ref-postel-vinayEquilibriumWageDispersion2002}{Postel-Vinay
and Robin 2002}) is that location plays a role: if a firm is located in
a different location than the worker's current employer then the
poaching firm must cover the cost of moving, this leads to two possible
outcomes:

\begin{itemize}
\tightlist
\item
  \(J^{j'}_{t+1}(x,y')>J^j_{t+1}(x,y)+F^{j\to j'}\) the worker moves
  from \((j,y) \to (j',y')\) and receives
  \(W^{j\to j'}_{1,t+1}(x,y',y)\)
\item
  \(J^j_{t+1}(x,y)>J^{j'}_{t+1}(x,y')-F^{j\to j'}\) the worker stays at
  \((j,y)\) and receives \(W^{j}_{1,t+1}(x,y,y')\)
\end{itemize}

to able to poach from different locations the firm must be at least
\(F^{j\to j'}\) more productive.

As in
(\protect\hyperlink{ref-postel-vinayEquilibriumWageDispersion2002}{Postel-Vinay
and Robin 2002}) if the worker is hired by the poaching firm the worker
receives the incumbent firm reservation value plus the cost of changing
jobs, i.e.

\[J^{j'}_{t+1}(x,y')>J^{j}_{t+1}(x,y)+F^{j\to j'}  \qquad \implies \qquad W^{j\to j'}_{1,t+1}(x,y',y) = J^{j}_{t+1}(x,y)+F^{j\to j'}\]

therefore

\begin{align*}
    J^j_{t}(x,y)=f(x,y,j,z_t)+\beta\max_{\phi^j_s(x)}\left\{\mathbb{E}_t\left[(1 - (1-\delta)\lambda^j_{t+1}(x,y))U^j_{t+1}(x) \right.\right. \\ \left.\left. + (1-\delta) \lambda^j_t(x,y)\sum_{j'\in\mathcal{J}}\phi_s^j(x,j')J^j_{t+1}(x,y)\right] - c(\phi^j_s(x))\right\}
\end{align*}

Note that the optimal strategy for employed workers is to engage in
random search i.e.:
\[\phi_{s}^{j}(x, j') = \frac{1}{\mid\mathcal{J}\mid} \qquad \forall\:x \text{ and }j,j'\in\mathcal{J}\]

thus:

\begin{equation}\protect\hypertarget{eq-bellman-match}{}{J^j_{t}(x,y)=f(x,y,j,z_t)+\beta\mathbb{E}_t\left[(1 - (1-\delta)\lambda^j_{t+1}(x,y))U^j_{t+1}(x) + (1-\delta) \lambda^j_t(x,y)J^j_{t+1}(x,y)\right]}\label{eq-bellman-match}\end{equation}

\hypertarget{match-surplus}{%
\subsection{Match Surplus}\label{match-surplus}}

Define the surplus of a match between a type \(x\) worker in location
\(j\) and a type \(y\) firm in location \(j'\) as:
\[S^{j\to j'}_{t}(x,y) = J^{j}_{t}(x,y) - [U^{j}_t(x) - F^{j\to j'}]\]

After some algebra we obtain the following expression for the surplus of
a match:
\begin{equation}\protect\hypertarget{eq-surplus}{}{S_{t}^{j\to j'}(x,y) = s(x,y,j \to j',z_t) - \Lambda^{j'}(x) - F^{j \to j'} + \beta\mathbb{E}_{t+1}\left[\max\left\{0, S^{j'\to j'}_{t+1}(x,y)\right\}\right]}\label{eq-surplus}\end{equation}

where \(\Lambda^{j'}(x)\) is a function of the expected value of the
difference of the instantaneous utility of a type \(x\) worker in \(j'\)
and every other location. Deriviation and function definitions are
Chapter~\ref{sec-appendix_surplus}.

Match surplus encodes all the necessary and sufficient conditions for a
firm \(y'\) in location \(j'\) to poach a worker from a firm \(y\) in
location \(j\). note: \begin{align*}
  S_t^{j\to j'}(x,y') - S^{j \to j}_t(x,y') &= J^{j'}_{t}(x,y') - [U^{j}_t(x) - F^{j\to j'}] - \left(J^{j}_{t}(x,y) - [U^{j}_t(x) - F^{j\to j}]\right) \\ 
  &=  J^{j'}_{t}(x,y') - [ J^{j}_{t}(x,y) + F^{j\to j'}]
\end{align*} therefore worker \(x\) is poached by firm \(y'\) in
location \(j'\) from firm \(y\) in location \(j\) if and only if the
surplus obtained from moving to \(j'\) and matching with \(y'\) is
higher than the surplus of staying at \(j\) matched with \(y'\).

When the aggregate state changes from \(z_{t-1} \to z_t\) the surplus
function determines how does the stock of unemployed and employed
workers change:
\[u^{j}_{t+}(x) = \underbrace{u^j_t(x)}_{\text{inherited from }t} + \overbrace{\int \Big(\underbrace{\mathbb{1}_{S^{j \to j}_t(x,y)<0}}_{\text{endogenous destruction}} + \underbrace{\delta\mathbb{1}_{S^{j \to j}_t(x,y)\geq0}}_{\text{exogenous destruction}}\Big)h^j_t(x,y)dy}^{\text{new unemployment created by shock}}\]
and
\[h^{j}_{t+}(x,y) = (1-\delta)\mathbb{1}_{\left\{S^{j \to j}(x,y)\geq 0\right\}}h^j_t(x,y)\]

\hypertarget{vacancy-creation}{%
\subsection{Vacancy Creation}\label{vacancy-creation}}

\begin{itemize}
\tightlist
\item
  \(V^j_t(y)\) is the expected value of a type \(y\) vacancy making
  contact with a worker in location \(j\). Vacancies are posted in the
  interim period and meet unemployed and employed type-\(x\) workers at
  a rates
  \[\frac{u^j_{t+}(x)}{L^j_t} \qquad \text{and} \qquad s\frac{h^j_{t+}(x,y)}{L^j_t}\]
  The expected value of posting a vacancy is therefore, the surplus that
  the posting firm expects to add, potential matches with negative
  surplus are immediately destroyed therefore those add no surplus. In
  terms of the Bellman equation we can write:
\end{itemize}

\begin{align}
V^j_t(y) &= \underbrace{\sum_{j'\in \mathcal{J}}\left( \int\underbrace{\frac{u^{j'}_{t+}(x)}{L^{j'}_t}}_{\text{likelihhod of match}}\times\overbrace{  S_t^{j'\to j}(x,y)^{+} }^{\text{match survives}}dx\right)}_{\text{expected value added from hiring unemployed workers}} + \ldots\\
&\\
&\ldots +\underbrace{\sum_{j'\in \mathcal{J}}\left(\int \left(\int\underbrace{s\frac{h^{j'}_{t+}(x,y)}{L^{j'}_t}}_{\text{likelihood of match}}\times \overbrace{ [S^{j' \to j}_t(x,y)-S^{j' \to j'}_{t}(x,y')]^{+}}^{\text{poaching is succesfull}}dx\right)dy\right)}_{\text{expected value added from poaching other firms employees}}
\end{align}

For simplicity we use the notation \(x^+ = \max\{0,x\}\).

Firms will post vacancies such that the marginal cost of the vacancies
and the marginal expected benefit \(V_t\) are equal:
\[c_{j}'(v^{j}_t(y))=q^{j}_{t}V^{j}_{t}(y)\]

\hypertarget{labor-market-flows}{%
\section{Labor Market Flows}\label{labor-market-flows}}

Now we characterize the flows of workers in-to and out-of unemployment
at each location :

\begin{itemize}
\tightlist
\item
  Let
  \[\eta^{j' \to j}(x,y) = \mathbb{1}_{\{S_{t}^{j' \to j}(x,y)>0\}}\]
  and
  \[\eta^{j' \to j}(x,y'\to y) = \mathbb{1}_{\{S^{j' \to j}_{t}(x,y) > S^{j' \to j'}_{t}(x,y')\}}\]
\item
  And \(\hat{\phi}^j_u(x,j')\) the probability that a type \(x\)
  unemployed worker from location \(j\) search in location \(j'\) (this
  the optimal search policy in
  Equation~\ref{eq-optimal-search-unemployed}).
\end{itemize}

Then the law of motion of the unemployment rate is:

\begin{align}
u^{j}_{t+1}(x) &= \underbrace{u^j_{t+}(x)\left(\sum_{j'\in \mathcal{J}}\hat{\phi}^{j}_{u}(x,j')\right)}_{\text{mass of workers leaving location }j} +\ldots \nonumber \\
&\hspace{3cm} \ldots+ \underbrace{u_{t+}^j(x)\int\left(p^j_t\frac{v^j_t(y)}{V^j_t}\hat{\phi}_u^j(x,j)\eta^{j\to j}(x,y)\right)}_{\text{staying workers that got a suitable job offer}} +\ldots \nonumber \\
&\hspace{3cm} \ldots+ \underbrace{\sum_{j\in \mathcal{J}}\left\{\left(1 - \hat{\phi}^{j'}_{u}(x,j)\int\left(\frac{v^j_{t}(y)}{V^j_t}\eta^{j\to j'}(x,y)dy \right)u^{j'}_{t+}(x) \right) \right\}}_{\text{arriving workers from other locations that dont get a job offer}}
\end{align}

and of the distribution of employment

\begin{align}
h^{j}_{t+1}(x,y) &= \underbrace{h_{t+}(x,y)}_{\text{employed at interim }} \times \overbrace{\prod_{j'\in\mathcal{J}}\left[ \underbrace{1 - \frac{s}{\mid \mathcal{J} \mid}\int\left( p^{j'}_t\frac{v^{j'}_t(y')}{V^{j'}_t} \eta^{j\to j'}(x,y\to y')\right)dy'}_{\text{no poeached by any firm in location }j'} \right]}^{\text{probability of not being poached}}+\ldots\nonumber
\\
&\hspace{6cm} \ldots+\sum_{j'\in \mathcal{J}}\left(\overbrace{\int\underbrace{ h^{j'}_{t+}(x,y')sp^j_t\frac{v^{j}_t(y)}{V^{j}_t}\eta^{j'\to j}(x,y'\to y)}_{\text{mass of workers poached from } y' \text{ firms in location } j'}dy'}^{\text{mass of workers that } y \text{ succesfully poach from location} j'} \right) \nonumber \\
&\hspace{6cm}\ldots +  \underbrace{\sum_{j'\in \mathcal{J}}\left( u^{j'}_{t+}(x)\hat{\phi}_{u}^{j'}(x, j)p_t\frac{v^{j}_t(y)}{V^{j}_t}\eta^{j' \to j}(x,y) \right)}_{\text{mass of workers hired from unemployment}}
\end{align}

We can compute the distribution of skill in each location as:

\[\ell^j_{t+1}(x) = u^j_{t+}(x) + \int h^j_{t+}(x,y)dy\]

and the total population in each location as:

\[\mu^j_{t+1} = \int \ell^j_{t+}(x)dx\]

\bookmarksetup{startatroot}

\hypertarget{endogenizing-location-productivity-and-cost-of-living}{%
\chapter{Endogenizing Location Productivity and Cost of
Living}\label{endogenizing-location-productivity-and-cost-of-living}}

This section focus on how the distribution of workers (skils) affect
both the productivity of matches \(f(x,y,j,z)\) and the instant utility
of workers \(b(x,j,z)\).

\hypertarget{location-productivity}{%
\section{Location Productivity}\label{location-productivity}}

I borrow from
(\protect\hyperlink{ref-davisSpatialKnowledgeEconomy2019}{Davis and
Dingel 2019}) in assuming that the productivity of workers in a location
\(j\) is a result of idea exchange process within each location.

\begin{itemize}
\tightlist
\item
  Assume that a type \(x\) worker in location \(j\) has a
  \(B(x, \overline{X}^j)\) where \(\overline{X}^j\) is the value of idea
  exchange in location \(j\). Thus:
\end{itemize}

\[f(x,y,j,z) = f\left(B(x, \overline{X}^j), y, z\right)\]

\begin{itemize}
\tightlist
\item
  Assume that the value of idea exchange in location \(j\) is a function
  of the distribution of skills in location \(j\):
  \(\overline{X}^j = \overline{X}\left(\left\{\ell^j(x)\right\}\right)\)
\end{itemize}

It's natural to make the following assumptions on
\(B(x, \overline{X}^j)\) and \(\overline{X}^j\):

\begin{itemize}
\tightlist
\item
  \textbf{Assumption 1}: \(B(x, \overline{X}^j)\) should be increasing
  in \(x\) and \(\overline{X}^j\) and in the absence of idea exchange,
  worker productivity is just their type: \(B(x, 0) = x\).
\item
  \textbf{Assumption 2}: Worker type \(x\) and idea exchange environment
  are complements i.e.~\(B(x, \overline{X}^j)\) supermodular in (\(x\) ,
  \(\overline{X}^j\)).
\item
  \textbf{Assumption 3}: {\textbf{{[}TO DO{]}}} Idea exchange
  environment is ``increasing'' in the distribution of skills in
  location \(j\). Probable need First Order Stocastic Dominance (FOSD)
  to define ``increasing'' in this context.
\end{itemize}

I will focus on the following functional forms for
\(B(x, \overline{X}^j)\) and \(\overline{X}^j\):

\begin{equation}
    B(x, \overline{X}^j) = x(1 + A \overline{X}^j x)
\end{equation}

where \(A\) is a parameter that captures the scope of gains from idea
exchange.

\begin{equation}
    \overline{X}\left(\left\{\ell^j(x)\right\}\right) = \left(1 - e^{-\nu \int \ell^j(x) dx}\right)\hat{x}^j =\left(1 - e^{-\nu \mu^j} \right)\hat{x}^j
\end{equation}

The probability of encountering someone during each moment of time
seeking is given by \(1 - \exp(-ν \mu^j)\), note that as the number of
potential exchange partners (\(\mu^j\)) increases, the probability of
encountering someone also increases, which makes intuitive sense.

The average ability of the individuals you encounter in these exchanges
is denoted as \(\hat{x}^j\). This is a weighted average of the abilities
of the people you meet

\[\hat{x}^j = \frac{1}{\mu^j}\int{x\ell^j(x)dx}=\frac{\mathbb{E}^j[x]}{\mu^j}\]

where \(\mathbb{E}^j[x]\) is the average ability of workers in location
\(j\).

\bookmarksetup{startatroot}

\hypertarget{computation-of-the-equilibrium}{%
\chapter{Computation of the
Equilibrium}\label{computation-of-the-equilibrium}}

\hypertarget{parametrization}{%
\section{Parametrization}\label{parametrization}}

\begin{itemize}
\tightlist
\item
  \(\{x_1,\ldots,x_{N_x}\}\subset[0,1]\) is a discretization of the
  continuum of worker types.

  \begin{itemize}
  \tightlist
  \item
    \(N_x=21\) as in the paper.\\
  \end{itemize}
\item
  Distribution of \(x\)-types is \(\text{Beta}(2.15, 12.0)\).

  \begin{itemize}
  \tightlist
  \item
    Parameters for the distribution are estimated by the authors.
  \end{itemize}
\item
  \(\{y_1,\ldots,y_{N_y}\}\subset[0,1]\) is a discretization of the
  continuum of firm types.

  \begin{itemize}
  \tightlist
  \item
    \(N_x=21\) as in the paper.\\
  \end{itemize}
\item
  Assume the productivity shock follows the following \(\text{AR}(1)\)
  process:\[\log{z_{t}} = \rho \log{z_{t+1}}+\varepsilon_t \qquad \varepsilon_t \sim \mathcal{N}(0,\sigma^2(1-\rho^2))\]

  \begin{itemize}
  \tightlist
  \item
    I discretize this process into a Markov with values
    \(\{z_1,\ldots,z_{N_z}\}\) and transition matrix \(\pi(z\mid z')\)
    using Tauchen's method.
  \item
    \(N_z=51\) as in the paper.
  \item
    \(\rho=0.999\) and \(\sigma = 0.071\) as in the paper.
  \end{itemize}
\item
  I set \(\beta=0.95\) consistent with a \(5\%\) discount rate as in the
  paper.
\item
  Value added at the match level takes the functional
  form\[f(x,y,z_t) = z_t\times(p_1 + p_2 x + p_3y + p_4 x^2+ p_5 y^2 + p_6 xy)\]

  \begin{itemize}
  \tightlist
  \item
    With
    \((p_1, p_2, p_3, p_4, p_5, p_6) = (0.03, 2.053, -0.140, 8.035, -1.907, 6.596)\)
    as estimated by the authors.
  \end{itemize}
\item
  Denote \(y^*(x,z)\) the firm type that maximizes the surplus of worker
  \(x\) When the aggregate state is \(z\).
\item
  Home production is characterized as
  \[b(x) = b_{share} f(x,y^*(x,1),1)\]

  \begin{itemize}
  \tightlist
  \item
    \(b_{share} = 0.7\) the same that the authors use (they take it from
    (\protect\hyperlink{ref-hallEmploymentFluctuationsEquilibrium2005}{Hall
    2005}))
  \end{itemize}
\item
  The matching function is
  \[M(L_t, V_t) = \min\{\alpha L_t^{\omega}V_t^{1-\omega}, L_t, V_t\}\]

  \begin{itemize}
  \tightlist
  \item
    The authors estimate \(\alpha = 0.497\) and \(\omega=0.5\).
  \end{itemize}
\item
  The cost of creating a \(v\) vacancies are
  \[c(v) = \frac{c_0 v^{1-c_1}}{1 - c_1}\]

  \begin{itemize}
  \tightlist
  \item
    The authors estimate \(c_0 = 0.028\) and \(c_1 = 0.084\).
  \end{itemize}
\end{itemize}

\appendix
\addcontentsline{toc}{part}{Appendices}

\hypertarget{sec-appendix_search_unemp}{%
\chapter{Optimal Search Strategy Unemployed
Workers}\label{sec-appendix_search_unemp}}

Unemployed agents solve the following maximization problem:

\begin{align*}
    \max_{\phi^j_u(x)}&\left\{ \sum_{j'\in\mathcal{J}}\phi^j_u(x, j')\mathbb{E}_t\Big[U^{j'}_{t+1}(x)  \Big] -c(\phi^j_u(x)) \right\} \\ \\
    \text{subject to: } & \sum_{j'\in \mathcal{J}}\phi^j_u(x, j') = 1 \\
    & \hspace{1.1 cm} \phi^j_u(x, j') \geq 0 \qquad \forall j'\in \mathcal{J}
\end{align*}

I'll ignore the non-negativity constraints and write the Lagrangean of
the problem:

\[\mathcal{L}(\phi^j_u(x), \lambda) =  \sum_{j'\in\mathcal{J}} \phi^j_u(x, j')\mathbb{E}_t\Big[U^{j'}_{t+1}(x)  \Big] -c(\phi^j_u(x)) - \lambda \left(\sum_{j'\in \mathcal{J}}\phi^j_u(x, j') - 1\right)\]

First order conditions of the problem give us:

\begin{align*}
  [\phi^j_u(x, j')] &:\quad \mathbb{E}_t\Big[U^{j'}_{t+1}(x)  \Big] - c_1 - c_1 \log[J \phi^j_u(x, j')] = \lambda \\
  [\lambda] &: \quad \sum_{j'\in \mathcal{J}}\phi^j_u(x, j') = 1
\end{align*}

Take any two \(j_1\), \(j_2\) we have that

\[\mathbb{E}_t\left[U^{j_1}_{t+1}(x)  \right] - c_1 \log[J \phi^j_u(x, j_1)] = \mathbb{E}_t\left[U^{j_2}_{t+1}(x)  \right] - c_1 \log[J \phi^j_u(x, j_2)]\]

thus

\[\frac{\mathbb{E}_t\left[U^{j_1}_{t+1}(x)\right] - \mathbb{E}_t\left[U^{j_2}_{t+1}(x)\right]}{c_1} = \log\left(\frac{ \phi^j_u(x, j_1)}{ \phi^j_u(x, j_2)}\right) \quad \implies \quad \frac{ \phi^j_u(x, j_1)}{ \phi^j_u(x, j_2)} = \frac{e^{\left(\mathbb{E}_t\left[U^{j_1}_{t+1}(x)\right] /c_1\right)}}{e^{\left(\mathbb{E}_t\left[U^{j_2}_{t+1}(x)\right] /c_1\right)}}\]

Fix any \(\hat{j}\), then we can write any other \(j'\in\mathcal{J}\) in
therms of \(\hat{j}\) and plug into the constraint to get:

\[\sum_{j'\in \mathcal{J}}\phi^j_u(x, j') =\sum_{j'\in \mathcal{J}}\frac{e^{\left(\mathbb{E}_t\left[U^{j'}_{t+1}(x)\right] /c_1\right)}}{e^{\left(\mathbb{E}_t\left[U^{\hat{j}}_{t+1}(x)\right] /c_1\right)}} \phi^j_u(x, \hat{j}) = \frac{\phi^j_u(x, \hat{j})}{e^{\left(\mathbb{E}_t\left[U^{j_2}_{t+1}(x)\right] /c_1\right)}} \sum_{j\in \mathcal{J}}e^{\left(\mathbb{E}_t\left[U^{j'}_{t+1}(x)\right] /c_1\right)} = 1\]

Which we can solve to obtain

\[\boxed{
  \phi^j_u(x,j') = \frac{e^{\left(\mathbb{E}_t\left[U^{j'}_{t+1}(x)\right] /c_1\right)}}{\sum_{\tilde{j}\in \mathcal{J}}e^{\left(\mathbb{E}_t\left[U^{\tilde{j}}_{t+1}(x)\right] /c_1\right)}}}\]

Note that the non-negativity constraints are satisfied because the
exponential function is always positive.

\hypertarget{sec-appendix_bellman_unemp}{%
\chapter{Derivation of Unemployed Bellman
Equation}\label{sec-appendix_bellman_unemp}}

The Bellman of a unemployed worker is (omitting time and worker types):

\[U^{j} = b + \beta\max_{\phi}\left\{\sum_{j'\in \mathcal{J}} \left(\phi(j')\mathbb{E}_t\left[U^{j'} \right]\right) -c(\phi) \right\}\]

Where the optimal strategy we obtained in
Chapter~\ref{sec-appendix_search_unemp}

\begin{equation}\protect\hypertarget{eq-optimal-search-unemp}{}{\phi(j') = \frac{e^{\left(\mathbb{E}_t\left[U^{j'}\right] /c_1\right)}}{\sum_{\tilde{j}\in \mathcal{J}}e^{\left(\mathbb{E}_t\left[U^{\tilde{j}}\right] /c_1\right)}}}\label{eq-optimal-search-unemp}\end{equation}
and the cost of a search policy (strategy) is:

\[c(\phi) = c_{1} \sum_{j\in \mathcal{J}}\phi(j')\log(J \phi(j'))\]

We want to plug the best policy and obtain the Bellman. The continuation
value takes the form:

\begin{align*}
& \sum_{j'\in \mathcal{J}} \left[ \frac{e^{\left(\mathbb{E}_t\left[U^{j'}\right] /c_1\right)}}{\sum_{\tilde{j}\in \mathcal{J}}e^{\left(\mathbb{E}_t\left[U^{\tilde{j}}\right] /c_1\right)}}\mathbb{E}_t\left[U^{j'} \right]
- c_1\left( \frac{e^{\left(\mathbb{E}_t\left[U^{j'}\right] /c_1\right)}}{\sum_{\tilde{j}\in \mathcal{J}}e^{\left(\mathbb{E}_t\left[U^{\tilde{j}}\right] /c_1\right)}}\right)\log{\left(J \frac{e^{\left(\mathbb{E}_t\left[U^{j'}\right] /c_1\right)}}{\sum_{\tilde{j}\in \mathcal{J}}e^{\left(\mathbb{E}_t\left[U^{\tilde{j}}\right] /c_1\right)}}\right)} \right]\\
\implies \quad & \sum_{j'\in \mathcal{J}} \left\{\frac{e^{\left(\mathbb{E}_t\left[U^{j'}\right] /c_1\right)}}{\sum_{\tilde{j}\in \mathcal{J}}e^{\left(\mathbb{E}_t\left[U^{\tilde{j}}\right] /c_1\right)}} \left[\mathbb{E}_t\left[U^{j'} \right]
- c_1\log{\left(J \frac{e^{\left(\mathbb{E}_t\left[U^{j'}\right] /c_1\right)}}{\sum_{\tilde{j}\in \mathcal{J}}e^{\left(\mathbb{E}_t\left[U^{\tilde{j}}\right] /c_1\right)}}\right)} \right]\right\}\\
  \implies \quad & 
\sum_{j'\in \mathcal{J}} \left\{\frac{e^{\left(\mathbb{E}_t\left[U^{j'}\right] /c_1\right)}}{\sum_{\tilde{j}\in \mathcal{J}}e^{\left(\mathbb{E}_t\left[U^{\tilde{j}}\right] /c_1\right)}} \left[{\mathbb{E}_t\left[U^{j'} \right]}
- c_1\left(\log{\left(J\right)} + {\log{\left(e^{\left(\mathbb{E}_t\left[U^{j'}\right] /c_1\right)}\right)}} - \log{\left(\sum_{\tilde{j}\in \mathcal{J}}e^{\left(\mathbb{E}_t\left[U^{\tilde{j}}\right] /c_1\right)}\right)}\right)\right]\right\}\\   \implies\quad&
c_1\sum_{j'\in \mathcal{J}}\left\{ \frac{e^{\left(\mathbb{E}_t\left[U^{j'}\right] /c_1\right)}}{\sum_{\tilde{j}\in \mathcal{J}}e^{\left(\mathbb{E}_t\left[U^{\tilde{j}}\right] /c_1\right)}} \left[
\log{\left(\sum_{\tilde{j}\in \mathcal{J}}e^{\left(\mathbb{E}_t\left[U^{\tilde{j}}\right] /c_1\right)}\right)} - \log{\left(J\right)} \right]\right\}\\
\implies\quad&c_1\left[
\log{\left(\sum_{\tilde{j}\in \mathcal{J}}e^{\left(\mathbb{E}_t\left[U^{\tilde{j}}\right] /c_1\right)}\right)} - \log{\left(J\right)} \right] {\frac{1}{\sum_{\tilde{j}\in \mathcal{J}}e^{\left(\mathbb{E}_t\left[U^{\tilde{j}}\right] /c_1\right)}} }{\sum_{j'\in \mathcal{J}}e^{\left(\mathbb{E}_t\left[U^{j'}\right] /c_1\right)}} 
\end{align*}

Thus we obtain:

\begin{align*}
U^{j} &= b + \beta c_1\left[
\log{\left(\sum_{\tilde{j}\in \mathcal{J}}e^{\left(\mathbb{E}_t\left[U^{\tilde{j}}\right] /c_1\right)}\right)} - \log{\left(J\right)} \right]
\end{align*}

\hypertarget{sec-appendix_surplus}{%
\chapter{Derivation of Surplus Bellman
Equation}\label{sec-appendix_surplus}}

First note that the differerence in unemployement value between two
locations is:

\[U^{j}_{t}(x) - U^{j'}_{t}(x) = b(x,j,z_t) - b(x,j',z_t) \]

we will use this fact later.

We start by deriving the expression for the surplus created by a match
within a location \(S^{j\to j}(x,y)\). Re-write
Equation~\ref{eq-bellman-match} as:

\begin{equation}\protect\hypertarget{eq-bellman-match-2}{}{J^j_t(x,y) = f(x,y,j,z_t) + \beta \mathbb{E}_t\left[(1-\delta)\lambda^j_{t+1}(x,y)\left(J^j_{t+1}(x,y)-U_{t+1}^j(x)\right) \right]+ \beta \mathbb{E}_t\left[U^j_{t+1}(x)\right]}\label{eq-bellman-match-2}\end{equation}

Note that

\[\mathbb{E}_t\left[U^j_{t+1}(x)\right] - U^j_{t}(x) = \mathbb{E}_t\left[U^j_{t+1}(x)\right] - b(x,j,z)-\beta c_{1}\text{lse}\left(\left\{\frac{\mathbb{E}_{t}[U^{j'}_{t+1}(x)]}{c_{1}}\right\}\right) - \beta c_{1}\log{J}\]

Focus on the term:

\[\beta \mathbb{E}_t\left[U^j_{t+1}(x)\right] - \beta c_{1}\text{lse}\left(\left\{\frac{\mathbb{E}_{t}[U^{j'}_{t+1}(x)]}{c_{1}}\right\}\right)\]

we take advantaje of the following translation identity property of the
\(\text{lse}\) function:

\[\text{lse}\left(\left\{x_{i}\right\}\right)=\text{lse}\left(\left\{x_{i}-a\right\}\right)+a \quad \implies \quad a - \text{lse}\left(\left\{x_{i}\right\}\right) = - \text{lse}\left(\left\{x_{i}-a\right\}\right)\]

thus we can write:

\begin{align*}
  \beta \mathbb{E}_t\left[U^j_{t+1}(x)\right] - \beta c_{1}\text{lse}\left(\left\{\frac{\mathbb{E}_{t}[U^{j'}_{t+1}(x)]}{c_{1}}\right\}\right) &= - \beta c_{1}\text{lse}\left(\left\{\frac{\mathbb{E}_{t}[U^{j'}_{t+1}(x)]-\mathbb{E}_t\left[U^j_{t+1}(x)\right]}{c_{1}}\right\}\right)\\
  & = - \beta c_{1}\text{lse}\left(\left\{\frac{\mathbb{E}_{t}\left[U^{j'}_{t+1}(x)-U^j_{t+1}(x)\right]}{c_{1}} \right\}\right) \\
  & = - \beta c_{1}\text{lse}\left(\left\{\frac{\mathbb{E}_{t}\left[b(x,j',z_{t+1}) - b(x,j,z_{t+1})\right]}{c_{1}} \right\}\right) 
\end{align*}

Subtracting \(U^j_{t}(x)\) to both sides of
Equation~\ref{eq-bellman-match-2} and using the previous result we get:

\begin{align*}
  J^j_t(x,y) - U^j_{t}(x) &= f(x,y,j,z_t) - b(x,j,z_t) - \beta c_1 \log\left(J\right) - \beta c_{1}\text{lse}\left(\left\{\frac{\mathbb{E}_{t}\left[b(x,j',z_{t+1}) - b(x,j,z_{t+1})\right]}{c_{1}} \right\}\right) + \ldots\\
  & \hspace{10cm} \ldots + \beta \mathbb{E}_t\left[(1-\delta)\lambda^j_{t+1}(x,y)\left(J^j_{t+1}(x,y)-U_{t+1}^j(x)\right) \right] 
\end{align*}

Define \(s(x,y,j\to j',z_t) = f(x,y,j,z_t) - b(x,j',z_t)\) and
\[\Lambda^j(x) = \beta c_1 \left( \log\left(J\right) + \text{lse}\left(\left\{\frac{\mathbb{E}_{t}\left[b(x,j',z_{t+1}) - b(x,j,z_{t+1})\right]}{c_{1}} \right\}\right)\right)\]
and the Bellman equation becomes:

\[S_{t}^{j\to j}(x,y) = s(x,y,j \to j,z_t) - \Lambda^j(x) + \beta\mathbb{E}_{t+1}\left[\max\left\{0, S^{j\to j}_{t+1}(x,y)\right\}\right]\]

Next consider the the surplus created by a match between a worker \(x\)
in location \(j_1\) and a firm \(y\) in location \(j_2\):\footnote{Note
  that \(F^{j\to j} = 0\) therefore we are generalizing the case where
  \(j_1 = j_2\)}.

\begin{align*}
  S_{t}^{j_1 \to j_2} &= J_{t}^{j_2}(x,y) - [U_{t}^{j_1}(x) + F^{j_1\to j_2}] \\
  & = \left(J_{t}^{j_2}(x,y) - U_{t}^{j_2}(x)\right) - \left(U_{t}^{j_1}(x) - U_{t}^{j_2}(x)\right) - F^{j_1\to j_2}\\
  & =  \left(J_{t}^{j_2}(x,y) - U_{t}^{j_2}(x)\right) - \left(b(x,j_1,z_t) - b(x,j_2,z_t)\right) - F^{j_1\to j_2}\\
  & = S^{j_2 \to j_2}_t(x,y)  - \left(b(x,j_1,z_t) - b(x,j_2,z_t)\right) - F^{j_1\to j_2}\\
  & = s(x,y,j_2 \to j_2,z_t) - \Lambda^{j_2}(x) + \beta\mathbb{E}_{t+1}\left[\max\left\{0, S^{j_2\to j_2}_{t+1}(x,y)\right\}\right]  - \left(b(x,j_1,z_t) - b(x,j_2,z_t)\right) - F^{j_1\to j_2}\\
  & = s(x,y,j_1 \to j_2,z_t) - \Lambda^{j_2}(x) + \beta\mathbb{E}_{t+1}\left[\max\left\{0, S^{j_2\to j_2}_{t+1}(x,y)\right\}\right] - F^{j_1\to j_2}
\end{align*}

\hypertarget{bibliography}{%
\chapter*{References}\label{bibliography}}
\addcontentsline{toc}{chapter}{References}

\hypertarget{refs}{}
\begin{CSLReferences}{1}{0}
\leavevmode\vadjust pre{\hypertarget{ref-cheremukhinTargetedSearchMatching2020}{}}%
Cheremukhin, Anton, Paulina Restrepo-Echavarria, and Antonella Tutino.
2020. {``Targeted Search in Matching Markets.''} \emph{Journal of
Economic Theory} 185 (January): 104956.
\url{https://doi.org/10.1016/j.jet.2019.104956}.

\leavevmode\vadjust pre{\hypertarget{ref-davisSpatialKnowledgeEconomy2019}{}}%
Davis, Donald R., and Jonathan I. Dingel. 2019. {``A {Spatial Knowledge
Economy}.''} \emph{American Economic Review} 109 (1): 153--70.
\url{https://doi.org/10.1257/aer.20130249}.

\leavevmode\vadjust pre{\hypertarget{ref-hallEmploymentFluctuationsEquilibrium2005}{}}%
Hall, Robert E. 2005. {``Employment {Fluctuations} with {Equilibrium
Wage Stickiness}.''} \emph{American Economic Review} 95 (1): 50--65.
\url{https://doi.org/10.1257/0002828053828482}.

\leavevmode\vadjust pre{\hypertarget{ref-liseMacrodynamicsSortingWorkers2017}{}}%
Lise, Jeremy, and Jean-Marc Robin. 2017. {``The {Macrodynamics} of
{Sorting} Between {Workers} and {Firms}.''} \emph{American Economic
Review} 107 (4): 1104--35. \url{https://doi.org/10.1257/aer.20131118}.

\leavevmode\vadjust pre{\hypertarget{ref-postel-vinayEquilibriumWageDispersion2002}{}}%
Postel-Vinay, Fabien, and Jean-Marc Robin. 2002. {``Equilibrium {Wage
Dispersion} with {Worker} and {Employer Heterogeneity}.''}
\emph{Econometrica} 70 (6): 2295--2350.
\url{https://doi.org/10.1111/j.1468-0262.2002.00441.x}.

\leavevmode\vadjust pre{\hypertarget{ref-simsImplicationsRationalInattention2003}{}}%
Sims, Christopher A. 2003. {``Implications of Rational Inattention.''}
\emph{Journal of Monetary Economics} 50 (3): 665--90.
\url{https://doi.org/10.1016/S0304-3932(03)00029-1}.

\leavevmode\vadjust pre{\hypertarget{ref-wuPartiallyDirectedSearch2020}{}}%
Wu, Liangjie. 2020. {``Partially {Directed Search} in the {Labor
Market}.''} PhD thesis, University of Chicago.

\end{CSLReferences}



\end{document}
